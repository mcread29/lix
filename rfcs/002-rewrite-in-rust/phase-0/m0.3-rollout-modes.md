# M0.3 Feature-Flag Rollout Modes and Verification

Status: completed for Phase 0 baseline.

## Scope Constraints

- SQLite-only scope remains unchanged.
- SDK continues to own SQLite lifecycle and runtime wiring.
- Rollout controls are configuration-only in Phase 0 (no default-on migration).

## Rollout Modes

Implemented in `packages/sdk/src/lix/open-lix.ts`.

- `legacy`: default mode; current JS path remains active.
- `rust_active`: Rust path can be selected explicitly.
- `rust_shadow`: available mode identifier, but shadow execution remains optional.

Resolved rollout behavior:

- `rustRewrite.mode` defaults to `legacy`.
- `rustRewrite.rustShadow.enabled` defaults to `false`.
- `rust_active` does not require `rust_shadow` to be enabled.

## SDK Surface

- New `OpenLixArgs.rustRewrite` option:
  - `mode?: "legacy" | "rust_active" | "rust_shadow"`
  - `rustShadow?: { enabled?: boolean }`
- New resolver helper: `resolveRustRewriteRolloutConfig(args)`.
- New runtime field on `Lix`: `rustRewrite` with resolved mode + shadow flag.

## Verification Evidence

- `pnpm --filter @lix-js/sdk exec vitest run src/lix/open-lix.test.ts -t "rust rewrite rollout|rust_active mode works|rust_shadow can be enabled independently"`
  - Results: 3 passed, 12 skipped.
- `pnpm --filter @lix-js/sdk exec tsc --noEmit`
  - Result: pass.
- `pnpm --filter @lix-js/sdk lint`
  - Result: pass.
